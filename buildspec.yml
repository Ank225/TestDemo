version: 0.2

phases:
  pre_build:
    commands:
      - cd app/src/main/java/com/bikayi/apps
      - mv mydemoapp mydemoapp2
      - cd "$OLDPWD"
      - cd app/src/test/java/com/bikayi/apps
      - mv mydemoapp mydemoapp2
      - cd "$OLDPWD"
      - cd app/src/androidTest/java/com/bikayi/apps
      - mv mydemoapp mydemoapp2
      - cd "$OLDPWD"
      - cd app/src/main
      - sed -i 's/mydemoapp/mydemoapp2/g' AndroidManifest.xml
      - cd "$OLDPWD"
      - cd app/src/main/java/com/bikayi/apps/mydemoapp2
      - find ./ -type f -readable -writable -exec sed -i "s/mydemoapp/mydemoapp2/g" {} \;
      - cd "$OLDPWD"
      - cd app/src/test/java/com/bikayi/apps/mydemoapp2
      - find ./ -type f -readable -writable -exec sed -i "s/mydemoapp/mydemoapp2/g" {} \;
      - cd "$OLDPWD"
      - cd app/src/androidTest/java/com/bikayi/apps/mydemoapp2
      - find ./ -type f -readable -writable -exec sed -i "s/mydemoapp/mydemoapp2/g" {} \;
      - cd "$OLDPWD"
      - cd app/src/main/res/values
      - sed -i 's/MyDemoApp/MyDemoApp2/g' strings.xml
      - cd "$OLDPWD"
      - cd app
      - sed -i 's/mydemoapp/mydemoapp2/g' build.gradle
      - cd "$OLDPWD"
  build:
    commands:
      - keytool -genkeypair -dname "cn=Sachin, ou=EnggTeam, o=Bikayi, c=IN" -alias my-alias -keypass 123456 -keystore my-key.jks -keyalg DSA -storepass 123456 -validity 10000
      - chmod +x gradlew
      - ./gradlew assembleRelease
      - cd app/build/outputs/apk/release
      - ls
artifacts:
  secondary-artifacts:
    artifact1:
      base-directory: apk
      files:
        - app/build/outputs/apk/release/app-release-unsigned.apk
    artifact2:
      base-directory: key
      files:
        - my-key.jks
